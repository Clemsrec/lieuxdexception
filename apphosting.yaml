# Firebase App Hosting Configuration - Lieux d'Exception
# Documentation: https://firebase.google.com/docs/app-hosting

# Runtime et Build
runConfig:
  # Runtime Node.js pour Next.js
  runtime: nodejs20
  
  # Variables d'environnement publiques (côté client)
  # Ces valeurs sont PUBLIQUES et visibles dans le code JavaScript du navigateur
  env:
    - variable: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
      value: lieux-d-exceptions.firebaseapp.com
      
    - variable: NEXT_PUBLIC_FIREBASE_PROJECT_ID
      value: lieux-d-exceptions
      
    - variable: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
      value: lieux-d-exceptions.appspot.com
      
    - variable: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
      value: "886228169873"
      
    - variable: NEXT_PUBLIC_FIREBASE_APP_ID
      value: 1:886228169873:web:154416b7ee0e74b70cfb30
      
    - variable: NEXT_PUBLIC_FIREBASE_DATABASE_ID
      value: lieuxdexception
      
    - variable: NEXT_PUBLIC_APP_URL
      value: https://lieux-d-exceptions.web.app
      
    - variable: NODE_ENV
      value: production
  
  # Secrets depuis Google Cloud Secret Manager
  # Ces valeurs sont PRIVÉES et injectées de manière sécurisée
  # Format: projects/PROJECT_ID/secrets/SECRET_NAME/versions/latest
  secrets:
    # Clé API Firebase (côté client mais avec restrictions)
    - variable: NEXT_PUBLIC_FIREBASE_API_KEY
      secret: firebase-api-key
      
    # Clé privée Service Account (côté serveur uniquement)
    - variable: FIREBASE_PRIVATE_KEY
      secret: firebase-service-account-private-key
      
    - variable: FIREBASE_CLIENT_EMAIL
      secret: firebase-service-account-email
      
    - variable: FIREBASE_PROJECT_ID
      secret: firebase-project-id

# Configuration du build
buildConfig:
  # Commandes de build pour Next.js
  buildCommand: npm ci && npm run build
  
  # Répertoire de sortie Next.js
  outputDirectory: .next
  
  # Node version
  nodeVersion: "20"

# Région de déploiement
# Choisir la région la plus proche de vos utilisateurs
region: europe-west1

# Politique de mise à l'échelle
scaling:
  minInstances: 0  # Scale to zero quand pas d'utilisation
  maxInstances: 10 # Maximum 10 instances en parallèle
  
# Ressources allouées
cpu: 1
memory: 512M

# Health check
healthCheck:
  path: /api/health
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5

# Configuration du réseau
ingress:
  # Permet uniquement le trafic HTTPS
  requireHttps: true
